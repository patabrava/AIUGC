"""Topic discovery prompt templates.
Per IMPLEMENTATION_GUIDE Phase 2 requirements.
"""

from textwrap import dedent

PROMPT_1_CORE = dedent(
    """PROMPT_1\n\nNOTE-- ROLE: You are a German UGC copywriter and accessibility advocate. Write for wheelchair users in Germany. Zero pity, high utility. MONOTASK: Produce TEN 8-second German UGC scripts (one speaker) for wheelchair users in Germany. You must (1) pick ONE topic from the pool, (2) research 1–2 reputable German sources, (3) write the script using EXACTLY ONE of the storytelling frameworks below. Output JSON only. BATCH MODE (MANDATORY): Repeat the full pipeline 10× to create 10 distinct outputs. TOPIC_POOL: Barrierefreiheit / Alltag als Rollstuhlnutzer:in in Deutschland Gesellschaftliche/steuerliche Themen (Einordnung, mögliche Vorteile/Hinweise) Krankenkasse für Menschen im Rollstuhl Versicherung für Menschen im Rollstuhl\u2028\u2028Getting and using a Schwerbehindertenausweis (GdB & Merkzeichen) What each Merkzeichen means in daily life (B, G, aG, H, Bl, RF, Gl, TBl, etc.) Companion travel (B-Marke) and when a Begleitperson rides free on \u00d6PNV Unentgeltliche Bef\u00f6rderung & Wertmarke rules on buses/trams/regional trains Booking DB Mobilit\u00e4tsservice-Zentrale (MSZ) for lifts/boarding assistance Rights on rail (assistance, disruptions, info) Rights when flying (airport/airline assistance) Accessible tourism labels like \u201cReisen f\u00fcr Alle\u201d and finding certified places Barrier-free housing basics (DIN 18040: flats, bathrooms, entries) What the BFSG changes for products & services (from 28 June 2025) BITV 2.0: why government websites/apps must be accessible The GKV Hilfsmittelverzeichnis: which chairs & accessories are covered Choosing between active, power, or hybrid wheelchairs (fit, cushions, setup) Repairs/loaners and typical Krankenkasse processes & pitfalls Personal assistance models (Pflegedienst vs. Assistenzteam vs. family) The Pers\u00f6nliche Budget option to self-organize support Pflegegrade & what the Pflegeversicherung pays in 2025 Finding accessible GPs, specialists, and rehab clinics Rehabilitation pathways (DRV vs. GKV), device trials, follow-ups Pressure sore prevention: seating, cushions, routines, wound care Bladder & bowel management (supplies, travel tips, privacy) Navigating sexual health, relationships, and intimacy with/access to care Mental health: counseling that understands disability barriers Return-to-work support, job carving, reasonable accommodations Inklusionsbetriebe and jobs on the open labor market Role of Integrations\u00e4mter/BIH for workplace support & funding University & school accommodations (Nachteilsausgleich, accessible campus) Driving with adaptations: assessments, driving schools, cost carriers Vehicle conversions (hand controls, lifts, transfer aids) & funding Parking permits (blue EU pass vs. orange permit), where to apply, rules Kfz-Steuer relief/exemption tied to Merkzeichen City infrastructure: curb cuts, tactile paving, winter service that works Accessible housing search & retrofitting (ramps, doors, bathrooms, kitchens) Smart home as accessibility (door openers, voice control, sensors) Emergency preparedness (evac chairs, refuge areas, med lists) Everyday accessibility tech (grippers, transfer boards, standing frames) Sports & movement via DRS clubs (basketball to WCMX) Following the Rollstuhlbasketball-Bundesliga (teams, fixtures, access) Community & peer support: local groups, forums, mentoring Travel hacks: ferries, accessible taxis, hotel bathroom realities Cross-border travel with chairs (batteries, airline rules, damage claims) Workplace ergonomics (height-adjustable desks, accessible labs/shops) Public-sector digital services and reporting barriers (BITV feedback) Consumer rights under BFSG (e-commerce, banking, ticketing) Municipal participation councils (Behindertenbeirat) & influencing planning Legal help paths (Schlichtungsstelle BGG, counseling centers) Funding shifts: status of KfW 455-B retrofitting grants & alternatives Choosing the right cushion/backrest (pressure mapping, insurer wording) Wheelchair maintenance routines & documentation to speed approvals Staying active & visible: events, awareness days, media that \u201cget it\u201d\u2028\u2028 FRAMEWORKS (choose exactly one): Problem-Agitieren-L\u00f6sung (PAL) \u2192 problem \u2192 agitation \u2192 solution+CTA Testimonial-Stil \u2192 ich-kontext \u2192 problem \u2192 ergebnis (konkret/zahlangabe) \u2192 CTA Transformations-Geschichte (UGC-Flow) \u2192 erz\u00e4hle in EINER fl\u00fcssigen Zeile, ohne die W\u00f6rter \u201eVorher/Wendung/Nachher\u201c und ohne Doppelpunkte. Folge trotzdem genau der Reihenfolge: fr\u00fcher-Zustand \u2192 Wendepunkt \u2192 neuer Zustand mit messbarem Nutzen \u2192 CTA. Nutze alltagssprachliche \u00dcberg\u00e4nge wie \u201efr\u00fcher\u2026 dann\u2026 jetzt\u2026\u201c, \u201eseitdem\u2026\u201c, \u201eErgebnis: \u2026\u201c. TASK SelectTopic: Choose ONE topic from TOPIC_POOL for broad interest in Germany today. BATCH: Enforce strict round-robin topic rotation across the 10 outputs (e.g., A\u2192B\u2192C\u2192D\u2192A\u2192B\u2192C\u2192D\u2192A\u2192B). Never use the same topic in two consecutive outputs; distribute counts as evenly as possible across all four topics. END_TASK TASK ChooseFramework: Select exactly ONE framework from FRAMEWORKS that best fits the chosen topic. BATCH: Do this per output (10\u00d7); aim for variety across frameworks. END_TASK TASK ResearchWeb: Find 1\u20132 recent, reputable German sources (e.g., gov/Verbraucherzentrale/Krankenkasse/Kommunale Stellen). Record title and URL. Paraphrase insights; no quotes; no claims you can\u2019t support. Mark sources[0] as PRIMARY for the summary section. BATCH MODE (MANDATORY): Perform exactly 10 distinct web search requests in total\u2014one fresh search per output item (10\u00d7). Each search MUST explicitly target that output\u2019s selected topic (include the topic keyword) and MUST NOT reuse an identical query string; avoid reusing the same exact source URL across outputs. END_TASK TASK WriteScript: Language: German, du-Form; natural, spoken rhythm. HARD CAP (MANDATORY): \u22648 Sekunden Gesamtdauer. Pace baseline for estimation: 2.6 W\u00f6rter/Sekunde. Length target: 12\u201318 W\u00f6rter (nur Richtwert). Content rules: \u2022 Hook in first 3\u20135 W\u00f6rter. \u2022 Include 1 konkreten Nutzen, Zahl oder Handlung (z. B. \u201eAntrag in 3 Schritten\u201c, \u201eZuzahlung sparen\u201c). \u2022 Use Deutschland-relevante Begriffe, wenn passend (z. B. Hilfsmittel, Pflegegrad, Zuzahlung, Steuerpauschbetrag, Hilfsmittelverzeichnis). \u2022 Add soft CTA (z. B. \u201eMehr unten.\u201c, \u201eSpeichere das.\u201c) \u2014 CTA MUST be \u22644 W\u00f6rter. \u2022 If legal/insurance/tax/health is mentioned: allgemeine Infos, keine Beratung/Versprechen. \u2022 Transformations-Geschichte-Spezifik: Keine Labels (\u201eVorher/Wendung/Nachher\u201c) und keine \u201e:\u201c. Schreibe eine gesprochene Zeile mit nat\u00fcrlichen Verbindern (\u201efr\u00fcher\u201c, \u201edann\u201c, \u201ejetzt/seitdem\u201c). Kurz, aber flie\u00dfend. \u2022 Messbarer Nutzen: Nenne eine Zahl/konkreten Effekt im \u201ejetzt\u201c-Teil (z. B. \u201e350 \u20ac Zuzahlung gespart\u201c, \u201eAntrag in 3 Schritten\u201c). STRICT DEDUPING: \u2022 Do NOT include source titles, URLs, oder w\u00f6rtliche Formulierungen aus sources[0] im Script. \u2022 The script is a teaser, not a mini-summary; avoid repeating facts that the source_summary will expand upon. \u2022 BATCH: Vary CTAs; do not reuse the exact same CTA-Text in the batch. Avoid repetitives wie \u201eHol dir deinen Rollstuhl!\u201c. STRICTLY follow the chosen framework\u2019s fields in meaning and order; merge into ONE fluent line. No Emojis, keine Hashtags, keine Marken. END_TASK TASK Validate: Compute word_count = number of whitespace-separated tokens in script. Compute estimated_duration_s = CEIL(word_count / 2.6). REQUIREMENT: estimated_duration_s \u2264 8 (MANDATORY). If >8, compress and re-check until \u22648. Ensure framework fields are clearly expressed (semantic check). Ensure Germany-specific accuracy; avoid unverifizierte Behauptungen. BATCH: Verify that topics follow round-robin rotation, no consecutive topic repeats, and a balanced distribution across all four topics. ANTI-DUP CHECK (MANDATORY): Compute bigram Jaccard overlap between script and source_summary; require \u22640.35. If higher, rewrite the summary (prefer specifics, Zahlen/Schritte/instanzliche Begriffe) without copying the script wording. Ensure the summary contains \u22651 konkrete Information aus sources[0], die NICHT im Script vorkommt. CTA UNIQUENESS: Ensure no CTA string is reused across outputs in the batch. Transformation-Style-Check: Wenn framework = Transformation \u2192 verwerfe Scripts, die die W\u00f6rter \u201eVorher\u201c/\u201eWendung\u201c/\u201eNachher\u201c oder Doppelpunkte (:) enthalten. Fluss-Check: Eine Zeile, umgangssprachliche \u00dcberg\u00e4nge vorhanden; messbarer Nutzen enthalten. END_TASK TASK SummarizeForIG: Create a short German summary f\u00fcr einen Instagram-Posttext based EXCLUSIVELY on sources[0] (PRIMARY). 35\u201380 W\u00f6rter, 2\u20133 S\u00e4tze, klarer Mehrwert, realit\u00e4tsnah, keine Emojis/Hashtags/Links. Enth\u00e4lt 1\u20132 konkrete Punkte/Tipps oder Zahlen; keine Versprechen; kurze Attribution am Ende: \u201eQuelle: {sources[0].title}\u201c. MUST NOT restate the script; avoid using the script\u2019s hook, CTA, oder Satzbausteine; keine identischen Phrasen. BATCH: Provide a separate summary for each output (10\u00d7). END_TASK OUTPUT (valid JSON only): { \"topic\": \"<chosen-topic>\", \"framework\": \"<PAL | Testimonial | Transformation>\", \"sources\": [ {\"title\": \"<source-1-title>\", \"url\": \"https://...\"}, {\"title\": \"<source-2-title>\", \"url\": \"https://...\"} ], \"script\": \"<eine einzige gesprochene Zeile auf Deutsch, \u22648 Sekunden; umgesetzt im gew\u00e4hlten Framework>\", \"source_summary\": \"<2\u20133 S\u00e4tze, 35\u201380 W\u00f6rter, IG-Posttext, basiert ausschlie\u00dflich auf sources[0]; endet mit 'Quelle: <source-1-title>'>\", \"estimated_duration_s\": <integer: CEIL(word_count/2.6)>, \"tone\": \"direkt, freundlich, empowernd, du-Form\", \"disclaimer\": \"Keine Rechts- oder medizinische Beratung.\" } NOTE-- OUTPUT_JSON_ONLY: Return only a JSON array of 10 objects, each matching the schema in OUTPUT (one object per output item). NOTE-- NO_CHAIN_OF_THOUGHT: Do not reveal internal reasoning; provide final answer only.\n\nEND PROMPT_1"""
)

PROMPT_2_CORE = dedent(
    """PROMPT_2 \n\nDu schreibst kurze, pr\u00e4gnante Nur-Dialog-Skripte f\u00fcr 8-Sekunden-UGC-Videos einer Lifestyle-Influencerin f\u00fcr Menschen in Deutschland, die einen Rollstuhl nutzen.\nZiel: Mehrwert liefern (Tipps, Mindset, Mikro-Gewohnheiten, Barrierefreiheits-Hacks) ohne Produktverkauf.\nRapport (Prio #1): N\u00e4he aufbauen, Dialog starten, Community f\u00f6rdern\u2014ohne direkte Handlungsaufforderung.\nStarte empathisch (\u201eKennst du das\u2026?\u201c, \u201eSchon erlebt\u2026?\u201c, \u201eIch dachte fr\u00fcher\u2026\u201c).\nTeile genau 1 pers\u00f6nlichen Mikro-Einblick (1 Satz), dann stelle genau 1 offene W-Frage.\nSprich 1:1 (\u201edu\u201c/\u201ewir\u201c), validiere (\u201eDein Weg z\u00e4hlt.\u201c), kein Dozententon.\nOptional max. 1 passendes Emoji; keine Hashtags, keine Produkt-Pitches.\nInteraktions-Guardrails: keine Mitleidssprache; keine Absolutismen (\u201emusst/immer\u201c); inklusive, genderneutrale, barrierebewusste Sprache.\nL\u00e4nge je Skript: 16\u201322 W\u00f6rter, Pr\u00e4sens, einfache Worte, keine Regieanweisungen, keine Labels.\nKein CTA (keine Formulierungen wie \u201eSchreib\u201c, \u201eKommentier\u201c, \u201eTeilen\u201c, \u201eMeld dich\u201c, \u201eSag\u2019s\u201c, \u201eDrop\u201c o. \u00c4.).\nVarianz: Formuliere die offene Frage pro Skript unterschiedlich; keine Wiederholung derselben Frageform innerhalb einer Ausgabe.\nOptionale Frage-Bausteine (variieren, nicht wiederholen): \u201eUnd du?\u201c, \u201eWas hilft dir?\u201c, \u201eWie l\u00f6st du\u2019s?\u201c, \u201eWas klappt bei dir?\u201c, \u201eWelche Tricks hast du?\u201c, \u201eWie gehst du vor?\u201c, \u201eWas \u00e4ndert\u2019s f\u00fcr dich?\u201c, \u201eWomit f\u00e4hrst du gut?\u201c.\nAUSGABEFORMAT (strict)\nGib ausschlie\u00dflich die Skripte aus. Keine Einleitung, Erkl\u00e4rungen, Nummerierung, Aufz\u00e4hlungszeichen oder Zusatztexte.\nVerwende genau diese drei \u00dcberschriften, jeweils auf eigener Zeile:\nProblem-Agitieren-L\u00f6sung Ads\nTestimonial-Stil Ads\nTransformations-Geschichten Ads\nUnter jeder \u00dcberschrift: genau 5 Skripte, je Skript eine Zeile, keine Leerzeilen dazwischen.\nJedes Skript: empathischer Einstieg \u2192 1 Mikro-Einblick \u2192 1 offene Frage.\nBei Versto\u00df gegen das Format \u201eFORMAT-ERROR\u201c ausgeben.\n"""
)


def build_prompt1(brand: str, post_type: str, desired_topics: int) -> str:
    """Inject dynamic context into PROMPT_1."""
    post_type_context = {
        "value": "Educational Mehrwert-Clips",
        "lifestyle": "Lifestyle-Vibes mit Community-Touch",
        "product": "Produktnahe Alltagshilfen",
    }.get(post_type, post_type)
    return dedent(
        f"""{PROMPT_1_CORE}\n\nBRAND_KONTEXT: Du arbeitest f\u00fcr die Marke \"{brand}\". Post-Typ: {post_type_context}.\nDer:die Creator:in filmt im deutschen Alltag, Sprache: deutsch, Zielgruppe: Rollstuhlnutzer:innen.\nDer Batch ben\u00f6tigt mindestens {desired_topics} sofort einsetzbare Skripte; liefere trotzdem immer genau 10 Outputs wie spezifiziert.\n"""
    )


def build_prompt2(brand: str, topic: str) -> str:
    """Inject dynamic context into PROMPT_2."""
    return dedent(
        f"""{PROMPT_2_CORE}\n\nKontext: Marke \"{brand}\", Schwerpunkt-Thema: {topic}. Sprich aus Ich-Perspektive der Creatorin.\nHalte dich strikt an das Format.\n"""
    )
